orbs:
  gcp-cli: circleci/gcp-cli@2.4.0
version: 2.1
executors:
  my-custom-executor:
    docker:
      - image: cimg/base:stable
        environment:
          app: "onurs-test-app"
jobs:
  my-job-name: 
    executor: my-custom-executor
    steps:
      - gcp-cli/install:
          version: '369.0.0'
      - gcp-cli/initialize:
          gcloud-service-key: service_account 
          google-project-id: project_id
      - run: gcloud projects list
      - run: gcloud auth configure-docker europe-west2-docker.pkg.dev --quiet
      - run:
          name: Update PATH and Define Environment Variable at Runtime
          command: |
            echo 'export PATH=/bin/bash:$PATH' >> $BASH_ENV
            echo 'export timestamp=$(date +%Y%m%d%H%M%S)' >> $BASH_ENV
            echo 'export fullimagetag=$app:$timestamp' >> $BASH_ENV
            source $BASH_ENV
            echo $fullimagetag
      - run: source .
      - run: ls -la 
      # - run: docker build . -t $app -f Dockerfile
      # - run: docker push $IMAGE_WITH_TAG
workflows:
  my-custom-workflow:
    jobs:
      - my-job-name